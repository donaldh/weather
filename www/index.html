<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Carlston Cottage Weather</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <style>

.axis text {
  font: 10px sans-serif;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.grid .tick {
  stroke: lightgrey;
  opacity: 0.7;
}

.grid path {
  stroke-width: 0;
}

    </style>
  </head>
  <body>
    <div class="jumbotron">
      <div class="container">
        <h1>Carlston Cottage</h1>
        <p class="lead">This is a summary of the recent weather at Carlston Cottage.</p>
      </div>
    </div>
    <div class="container">
      <h4>Temperature in Celsius</h4>
      <div id="weather"></div>
      <script>
        d3.json('//' + document.location.hostname + ':8000/', function(error, json) {
        if (error) return console.warn(error);

	var data = json.data;

        var width = d3.select("#weather").node().getBoundingClientRect().width, height = 300, padding = 20;

        var xMin = Date.now(), xMax = new Date(0);
        data.forEach(function(d) { d[0] = new Date(d[0] * 1000);
        if (d[0] < xMin) { xMin = d[0]; }
                   if (d[0] > xMax) { xMax = d[0]; }
          });

          var x = d3.time.scale().domain([xMin, xMax]).range([0, width - padding * 2]);
          var y = d3.scale.linear().domain([-5, 25]).range([height - padding, padding]);

          var line = d3.svg.line()
          .x(function(d) { return x(d[0]); })
          .y(function(d) { return y(d[1]); })
          .interpolate('linear');

          var svg = d3.select('#weather').append('svg')
          .attr('width', width)
          .attr('height', height)
          .append('g').attr('transform', 'translate(20, 0)');

          svg.append('g').attr('class', 'x axis')
          .attr('transform', 'translate(0, ' + (height - padding) + ')')
          .call(d3.svg.axis().scale(x).orient('bottom'));

        svg.append('g').attr('class', 'y axis').call(d3.svg.axis().scale(y).orient('left'));
        svg.append('g').attr('class', 'grid').call(d3.svg.axis().scale(y).orient('left').tickSize(-width, 0, 0).tickFormat(''));

        svg.append('path').datum(data).attr('d', line).attr("stroke", "blue")
        .attr("stroke-width", 2).attr("fill", "none");
        });
      </script>
    </div>
  </body>
</html>
